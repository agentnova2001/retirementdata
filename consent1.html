<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consent 1</title>

<style>
body{margin:0;padding:12px;font-family:Arial,sans-serif}
.container{display:flex;width:100%;height:180px;border:2px solid #000;position:relative}
.box{flex:1;position:relative;display:flex;justify-content:center;align-items:center;
font-size:22px;font-weight:900;color:#000;text-align:center}
.agree{background:#ccecff}
.disagree{background:#fff;border-left:2px solid #000}
.tag{position:absolute;top:6px;left:50%;transform:translateX(-50%);
font-size:12px;font-weight:700}
canvas{position:absolute;top:0;left:0}
button{width:100%;margin-top:12px;padding:12px;font-size:16px;font-weight:bold}
</style>
</head>

<body>

<div class="container" id="pad">
  <div class="box agree">
    <div class="tag">[동의]</div>
    동의
  </div>
  <div class="box disagree">
    <div class="tag">[미동의]</div>
    동의하지<br>않음
  </div>
  <canvas id="draw"></canvas>
</div>

<button onclick="submit()">제출</button>
<button onclick="resetPad()">다시하기</button>

<script>
const canvas=document.getElementById("draw");
const pad=document.getElementById("pad");
const ctx=canvas.getContext("2d");

let drawing=false;
let selectedSide=null;

function resize(){
  canvas.width=pad.clientWidth;
  canvas.height=pad.clientHeight;
}
resize();window.addEventListener("resize",resize);

ctx.strokeStyle="rgba(0,180,0,0.5)";
ctx.lineWidth=4;ctx.lineCap="round";

function side(x){return x<canvas.width/2?"agree":"disagree"}
function pos(e){
  const r=canvas.getBoundingClientRect();
  const p=e.touches?e.touches[0]:e;
  return{x:p.clientX-r.left,y:p.clientY-r.top};
}

function start(e){
  drawing=true;
  const p=pos(e);
  selectedSide=side(p.x);
  ctx.beginPath();ctx.moveTo(p.x,p.y);
}

function move(e){
  if(!drawing)return;
  const p=pos(e);
  if(side(p.x)!==selectedSide){
    resetPad();drawing=false;return;
  }
  ctx.lineTo(p.x,p.y);ctx.stroke();
}

function stop(){drawing=false}
function resetPad(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  selectedSide=null;
}

pad.addEventListener("mousedown",start);
pad.addEventListener("mousemove",move);
window.addEventListener("mouseup",stop);
pad.addEventListener("touchstart",start);
pad.addEventListener("touchmove",move);
window.addEventListener("touchend",stop);

function submit(){
  if(!selectedSide){alert("동의 또는 미동의를 표시해주세요.");return;}

  const out=document.createElement("canvas");
  out.width=canvas.width;out.height=canvas.height;
  const o=out.getContext("2d");

  o.fillStyle="#ccecff";o.fillRect(0,0,out.width/2,out.height);
  o.fillStyle="#fff";o.fillRect(out.width/2,0,out.width/2,out.height);

  o.font="bold 22px Arial";o.fillStyle="#000";o.textAlign="center";
  o.fillText("동의",out.width/4,out.height/2);
  o.fillText("동의하지 않음",out.width*0.75,out.height/2);

  o.drawImage(canvas,0,0);

  const img=out.toDataURL("image/png");

  window.parent.postMessage({
    consent1_flag:selectedSide==="agree"?"Y":"N",
    consent1_image:img
  },"*");

  const w=window.open();
  w.document.title="Consent1 Result";
  w.document.write("<img src='"+img+"' style='width:100%'>");
}
</script>
</body>
</html>